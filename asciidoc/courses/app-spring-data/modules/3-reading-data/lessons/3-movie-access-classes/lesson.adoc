= Creating Movie repository and controller classes
:order: 3
:type: lesson

You have mapped the `Movie` and `Person` entities in our domain. Now we need to create a Movie repository interface and controller class to access the movies in the database.

== Movie repository interface

Start by creating a new interface file called `MovieRepository.java` in the `src/main/java/com/example/appspringdata` directory and extend it to match the following:

[source,java]
----
include::code/MovieRepository.java[tag=movie-repo]
----

Spring Data provides repository extensions for many of its supported projects. They include methods and functionality specifically designed and optimized for the data store. In this case, we are extending the `Neo4jRepository` interface. The first type parameter is the domain class that the repository will be working with, and the second type parameter is the type of the identifier for that domain class. In this case, we are using the `Movie` domain class and the `String` type for the identifier.

Spring Data also implements a few standard methods for us, such as `save`, `findById`, `findAll`, and `deleteById`. This is why we don't need to define queries and methods to start out. We will see how to define custom implementations later in this course.

Let's move on to the controller class, which will expose the results from our queries to users via an API.

== Movie controller class

Create a new class file called `MovieController.java` in the `src/main/java/com/example/appspringdata` directory and add the following code:

[source,java]
----
include::code/MovieController.java[tag=movie-controller]
----

This is a standard Spring MVC controller class. We have annotated it with `@RestController` to tell Spring that this class will be used to handle requests and responses and used `@RequestMapping` to handle requests at the `/movies` endpoint. The first line inside the class injects the repository interface, so that we can access and call our repository methods, then a constructor takes a `MovieRepository` instance as a parameter. This is called dependency injection and is a standard practice in Spring applications.

We have defined two methods to handle requests. The first method is annotated with `@GetMapping` and will handle requests to the `/movies` endpoint. It calls one of the out-of-the-box methods that Spring provides, the derived `findAll` method and returns a list of movies. The second method will handle requests to the `/movies/{movieId}` endpoint, including a path variable in the URL for a distinct movie id. It calls the derived `findById` method on the repository (passing in the path variable value) and returns the results.

We have now created a domain class, repository interface, and controller class. Let's run our application and test it out.

== Running and testing the application

We can run our application from our IDE or at the command line using `./mvnw spring-boot:run`. Once the application is running, we can open a browser and navigate to `http://localhost:8080/movies` to see the results of the `findAll` method.

.FindAll Results (example)
----
{
  "movieId":"1",
  "title":"Toy Story",
  "plot":"A cowboy doll is profoundly threatened and jealous when a new spaceman figure supplants him as top toy in a boy's room.",
  "poster":"https://image.tmdb.org/t/p/w440_and_h660_face/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg",
  "url":"https://themoviedb.org/movie/862",
  "imdbId":"0114709",
  "tmdbId":"862",
  "released":"1995-11-22",
  "year":1995,
  "runtime":81,
  "budget":30000000,
  "revenue":373554033,
  "imdbVotes":591836,
  "imdbRating":8.3,
  "languages":[
    "English"
  ],
  "countries":[
    "USA"
  ]
},
//additional results
----

[TIP]
.Random results order
====
Results may not be in the same order or formatted exactly as shown above. Formatted results depend on whether pretty-printing is enabled in your browser or command line styling.
====

We can also navigate to `http://localhost:8080/movies/2` to see the results of the `findById` method.

.FindById Results (example)
----
{
  "movieId": "2",
  "title": "Jumanji",
  "plot": "When two kids find and play a magical board game, they release a man trapped for decades in it and a host of dangers that can only be stopped by finishing the game.",
  "poster": "https://image.tmdb.org/t/p/w440_and_h660_face/vgpXmVaVyUL7GGiDeiK1mKEKzcX.jpg",
  "url": "https://themoviedb.org/movie/8844",
  "imdbId": "0113497",
  "tmdbId": "8844",
  "released": "1995-12-15",
  "year": 1995,
  "runtime": 104,
  "budget": 65000000,
  "revenue": 262797249,
  "imdbVotes": 198355,
  "imdbRating": 6.9,
  "languages": [
    "English",
    " French"
  ],
  "countries": [
    "USA"
  ]
}
----

[.summary]
== Summary

In this lesson, you created repository and controller classes to access `Movie` entities in the database.

Next, you will complete a challenge to apply the skills you learned here to create the Person repository and controller classes.