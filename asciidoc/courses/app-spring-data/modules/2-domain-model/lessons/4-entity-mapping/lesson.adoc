= Mapping Neo4j Object Types
:order: 4
:type: lesson

Nodes and Relationships are separate entities in the Neo4j database, and they are also mapped to separate classes in our application. Depending on your domain model, you will map the database entities to your application entities directly.

== Nodes & Relationships

Remember our Spring Data Neo4j building blocks lesson? The Neo4j Template and Spring Data Repositories layers apply the domain. This means that the generic driver type classes will not be used (and their methods inaccessible) when using the Spring Repositories layer. Instead, objects coming from the database will be mapped to the domain object and their methods.

.Memory recap: Spring Data Neo4j building blocks
image::images/sdn-buildingblocks.png[Spring Data Neo4j building blocks,width=600,align=center]

Let's look at this using our coffee shop example from the previous lesson.

=== Nodes

We can retrieve the coffee shop orders by setting the return type on the repository method to the domain object (in this case, `Order`). The https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#mapping.annotations.node[`@Node` annotation^] on the `Order` class tells Spring to map this domain object to node entities in the database.

.Working with Nodes
[source,java,role=ncopy,subs="attributes+",indent=0]
----
include::code/EntityMapping.java[tag=order-mapping]
----

Spring will try to map the object returned from the repository query to the `Order` class, and if it is unable to, the application will error. This is important to keep in mind when writing your queries that you must return the same object from the query that you want to map in the application domain.

The entity exposes the get and set methods that we define in our domain class for member variables. For example, `order.getCustomer()` would return the `Customer` object associated with the order.

=== Relationships

`Relationship` objects are similar to those for `Node` in that they also are mapped to any domain objects specified. If there are no specific properties on the relationship, you can skip a separate domain object and map connections between nodes directly. However, if you have relationship properties, then you create a separate class to map those values. Using the https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#mapping.annotations.relationship[`@Relationship` annotation^] notifies Spring that this variable maps to a relationship entity in the database.

.Working with Relationships
[source,java,role=ncopy,subs="attributes+",indent=0]
----
include::code/EntityMapping.java[tag=receipt-mapping]
----

Let's say you want to map an `orderTotal` property on the relationship between an `Order` and a `Customer`. You would need a `Receipt` class with the `@RelationshipProperties` annotation, then map the relationship from the `Order` to the `Receipt` entity and `Receipt` to `Customer`.

Just like with nodes, we can access relationship properties using getter and setter methods - for example, `receipt.getOrderTotal()`. However, since you cannot access only a relationship directly, you traverse from the node to the relationship entity to access it.

== Check Your Understanding

include::questions/1-node-mapping.adoc[leveloffset=+1]

include::questions/2-rel-mapping.adoc[leveloffset=+1]

[.summary]
== Lesson Summary

In this lesson, you learned how database node and relationship entities are mapped and handled in a Spring Data Neo4j application.

Next, we will begin the application you will create for this course, building the requirements and the data model that will underpin it.
