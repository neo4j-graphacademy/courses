= Writing Data to Neo4j
:type: challenge
:order: 5
:lab-file: src/challenges/write/challenge.ts
:lab-solution: src/challenges/write/solution.ts
:lab: {repository-blob}/main/{lab-file}
:branch: main

In this challenge you will use write data to Neo4j to add yourself as an actor in The Matrix.

Open the `{lab-file}` file that contains the starter code. 

== Steps

. Create the Cypher statement that will create new a `Person` node and `ACTED_IN` relationship to _The Matrix_ `Movie` node:
+
[source, typescript]
----
include::{repository-raw}/{branch}/{lab-solution}[tag=cypher]
----

. Create the `params` object and set your name:
+
[source, typescript]
----
include::{repository-raw}/{branch}/{lab-solution}[tag=params]
----

. Execute the Cypher statement using the `session.executeWrite()` method:
+
[source, typescript]
----
include::{repository-raw}/{branch}/{lab-solution}[tag=execute]
----

. Log the result to the console:
+
[source, typescript]
----
include::{repository-raw}/{branch}/{lab-solution}[tag=log_result]
----

== Run the Challenge

Run the file using `ts-node` to view the result:

[source,sh,subs=attributes+]
----
ts-node {lab-file}
----

If successful, you should see output similar to the following (with your name instead of "Your Name"):

.Expected Output
[source,json,role=nocopy]
----
{
  identity: Integer { low: 12345, high: 0 },
  labels: [ 'Person' ],
  properties: { name: 'Your Name' },
  elementId: '4:abc123:12345'
}
----

You can also verify the result in the Neo4j Browser by running the following query:

[source, cypher]
----
MATCH (m:Movie {title: "Matrix, The"})<-[a:ACTED_IN]-(p:Person)
RETURN m, a, p
----

You should see your `Person` node connected to _The Matrix_ movie.


include::questions/verify.adoc[leveloffset=+1]


== Troubleshooting

.ts-node: command not found
[%collapsible]
====
If you receive a `ts-node: command not found` error, you can either:

1. Install `ts-node` globally:
+
[source,sh]
----
npm install -g ts-node
----

2. Or run via npx:
+
[source,sh,subs=attributes+]
----
npx ts-node {lab-file}
----
====

.Cannot use import statement outside a module
[%collapsible]
====
This error occurs when Node.js tries to run TypeScript/ES modules as CommonJS.
Ensure your `tsconfig.json` has the correct module settings, or run with:

[source,sh,subs=attributes+]
----
npx ts-node --esm {lab-file}
----
====

.Verification fails but code works
[%collapsible]
====
If your code runs successfully and creates the node (you can see it in Neo4j Browser) but the verification fails:

1. Ensure you are using the sandbox provided by GraphAcademy (not a local database)
2. Check that the Person node was created with an `ACTED_IN` relationship to the movie titled "Matrix, The"
3. Try refreshing the page and clicking Verify again
====


[.summary]
== Lesson Summary

In this challenge, you used your knowledge to create a driver instance and run a Cypher statement.

Next, we will look at the Neo4j Type System and some of the considerations that you need to make when working with values coming from Neo4j in your TypeScript application.

// @last-fix 2025-12-02
