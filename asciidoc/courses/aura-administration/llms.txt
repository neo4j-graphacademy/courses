# Aura In Production

Learn how to backup, restore and monitor Neo4j Aura instances in production

[Learn more about this course](mdc:https://graphacademy.neo4j.com/courses/aura-administration)

## Course Overview

This course provides comprehensive guidance for database administrators managing Neo4j Aura instances in production environments. It covers operational methodologies, monitoring strategies, performance optimization processes, and incident response frameworks.

## Core Concepts

* **Snapshot** - Point-in-time copy of a database for backup and recovery
* **Full Snapshot** - Complete database backup at a specific point in time (exportable)
* **Differential Snapshot** - Incremental backup containing only changes since last full snapshot
* **Page Cache** - In-memory storage of graph data for fast query access
* **Heap Memory** - JVM memory used for query execution and transaction processing
* **Query Latency Percentiles** - Distribution of query execution times (50th, 75th, 99th)
* **Transaction** - Atomic unit of work ensuring ACID guarantees
* **Checkpoint** - Process of flushing pending updates from memory to disk
* **Replan Event** - Query execution plan recreation when database statistics change
* **Metrics Integration** - Export of Aura metrics to external monitoring platforms

## Module 1: Backup and Restore

Data protection and recovery methodologies for production databases.

### Lessons
* [Managing Snapshots](mdc:./1-backup-restore/1-snapshot-management/llms.txt) - Snapshot types, retention policies, and on-demand backups
* [Restore Operations](mdc:./1-backup-restore/5-restore-operations/llms.txt) - Recovery scenarios, restore procedures, and data migration

## Module 2: Logs and Query Optimization

Query performance analysis and security log monitoring.

### Lessons
* [Accessing Logs](mdc:./2-query-logs/1-logs-overview/llms.txt) - Log types, access methods, and interface navigation
* [Working with Query Logs](mdc:./2-query-logs/2-query-logs/llms.txt) - Finding slow queries, filtering strategies, and pattern identification
* [Optimizing Query Performance](mdc:./2-query-logs/4-optimizing-performance/llms.txt) - Query optimization methodology, prioritization, and validation
* [Security Logs](mdc:./2-query-logs/5-security-logs/llms.txt) - Authentication monitoring, audit compliance, and security analysis

## Module 3: Monitoring Resources

Resource utilization monitoring and scaling decisions.

### Lessons
* [Viewing Metrics](mdc:./3-monitoring-resources/1-metrics-overview/llms.txt) - Metrics dashboard navigation and metric categories
* [Monitoring CPU Usage](mdc:./3-monitoring-resources/2-cpu-usage/llms.txt) - CPU consumption patterns, bottleneck identification, and optimization
* [Monitoring Storage Consumption](mdc:./3-monitoring-resources/5-storage/llms.txt) - Storage growth planning and scaling decisions
* [Monitoring Out of Memory Errors](mdc:./3-monitoring-resources/7-oom-errors/llms.txt) - OOM error causes, mitigation strategies, and prevention

## Module 4: Monitoring Instance Performance

Instance-level performance metrics and optimization.

### Lessons
* [Heap Memory Usage](mdc:./4-monitoring-instance/1-heap-memory/llms.txt) - Heap monitoring, memory pressure identification, and optimization
* [Page Cache Performance and Evictions](mdc:./4-monitoring-instance/2-page-cache/llms.txt) - Cache hit ratios, eviction patterns, and performance tuning
* [Bolt Connections](mdc:./4-monitoring-instance/3-bolt-connections/llms.txt) - Connection monitoring, pool management, and leak detection
* [Monitoring Garbage Collection](mdc:./4-monitoring-instance/4-garbage-collection/llms.txt) - GC metrics, pause impact, and optimization strategies

## Module 5: Monitoring Database Health

Database-level metrics and health indicators.

### Lessons
* [Monitoring Database Store Size](mdc:./5-monitoring-database/1-store-size/llms.txt) - Storage monitoring, compaction decisions, and capacity planning
* [Monitoring Query Rate and Latency](mdc:./5-monitoring-database/2-query-metrics/llms.txt) - Query performance patterns and latency analysis
* [Transaction Monitoring](mdc:./5-monitoring-database/3-transactions/llms.txt) - Transaction patterns, rollback analysis, and best practices
* [Checkpoint and Replan Events](mdc:./5-monitoring-database/7-checkpoints-replan/llms.txt) - Internal operation monitoring and troubleshooting

## Module 6: Advanced Monitoring

External monitoring integration and alerting strategies.

### Lessons
* [Metrics Integration](mdc:./6-advanced-monitoring/1-metrics-integration/llms.txt) - Prometheus setup, Grafana dashboards, and alerting configuration

## Key Decision Frameworks

### When to Optimize vs Scale
**Optimize First When:**
* Specific queries have high latency (99th percentile >10x median)
* CPU spikes correlate with specific query patterns
* Page cache hit ratio is good but individual queries are slow
* Heap usage spikes during specific operations

**Scale When:**
* All optimization efforts exhausted
* Sustained resource usage above 80% despite optimization
* All query percentiles are high (systemic performance issues)
* Out of Memory errors occur during normal operations

### Incident Response Priority
1. **Restore Service** - Scale immediately for critical failures (100% CPU, OOM errors)
2. **Gather Data** - Check metrics dashboard, query logs, security logs
3. **Identify Root Cause** - Correlate metrics with application logs and deployments
4. **Apply Fix** - Optimize queries or scale based on root cause analysis
5. **Validate** - Monitor metrics to confirm resolution
6. **Document** - Record incident, resolution, and prevention strategies

## Common Production Scenarios

### "The Application is Slow"
1. Check Metrics dashboard for resource spikes
2. Review query logs filtered for slow queries (minimum duration >1000ms)
3. Identify if specific queries or systemic issue
4. Apply appropriate fix (optimize queries or scale instance)
5. Monitor to verify improvement

### "Users Can't Log In"
1. Check security logs for failed authentication events
2. Review connection metrics for pool exhaustion
3. Verify instance status and accessibility
4. Check recent deployments or configuration changes
5. Take corrective action and document resolution

### "We're Running Out of Storage"
1. Check store size metrics (allocated vs. used space)
2. Determine if growth or wasted space (after deletions)
3. If growth: Plan instance scaling and retention policies
4. If waste: Schedule database compaction
5. Implement ongoing data retention policies

### "Out of Memory Errors During Peak Traffic"
1. Scale instance immediately to restore service
2. Verify OOM errors stopped and metrics stabilized
3. Review query logs for high memory allocation patterns
4. Optimize problematic queries (add LIMIT, batch operations)
5. Set up alerts to prevent future occurrences

### "Queries Started Failing After Deployment"
1. Filter query logs for failed queries since deployment time

2. Identify specific failing queries and GQL status codes
3. Review error messages for root cause
4. Work with developers to fix queries or rollback
5. Monitor for resolution and document changes

## Production Best Practices Summary

### Proactive Monitoring
* Review metrics daily for production instances
* Set automated alerts at 70-80% resource thresholds
* Monitor trends to predict future capacity needs
* Document baseline patterns for your specific workload

### Performance Optimization
* Start with query logs to identify high-impact queries
* Always use parameters ($param) not literal values
* Add indexes on frequently queried properties
* Test optimizations in non-production environments first
* Measure before and after performance metrics

### Capacity Planning
* Track growth rates for CPU, storage, and query volume
* Plan for 20-30% headroom above current usage
* Scale before resources are constrained, not after
* Consider cost vs. performance tradeoffs

### Incident Response
* Stay calm and gather data before taking action
* Use metrics to identify what changed and when
* Correlate metrics, query logs, and application logs
* Fix immediate issue first, investigate root cause after
* Document incidents and resolutions for future reference

## External Resources

* [Neo4j Aura Documentation](https://neo4j.com/docs/aura/) - Complete Aura feature reference
* [Neo4j Operations Manual](https://neo4j.com/docs/operations-manual/current/) - Production deployment guidance
* [Cypher Query Tuning](https://neo4j.com/docs/cypher-manual/current/query-tuning/) - Query optimization reference
* [Aura Metrics Reference](https://neo4j.com/docs/aura/metrics/) - Metrics documentation and integration
