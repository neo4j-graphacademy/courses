= Checkpoint and Replan Events
:type: lesson
:order: 7


[.discrete]
== Introduction

Neo4j performs internal operations that help maintain database health and optimize query performance.

In this lesson, you will learn how to monitor checkpoint and replan events to understand your database activity.


== Understanding Checkpoints and Replan Events

**Checkpoints** are the process of writing committed transaction data from memory to disk. They ensure your data is safe and durable by creating recovery points. This is a normal, essential operation that occurs automatically.

**Replan events** occur when Neo4j recreates the execution plan for a Cypher query. Neo4j caches query plans for efficiency, rebuilding them when needed to ensure optimal performance as your data evolves.


== Monitoring Checkpoints

The Monitoring dashboard shows four checkpoint metrics: total count, rate (events per minute), cumulative time, and duration of the last checkpoint.

The typical **duration** is several seconds to several minutes, which is normal and healthy. The frequency depends on your write activity—busier databases checkpoint more often.

If you see checkpoint duration consistently over 30 minutes, this suggests an opportunity to optimize your write patterns or review storage performance.

[NOTE]
.Background maintenance
====
Checkpoint values may drop if background maintenance is performed by Aura. This is normal and doesn't indicate a problem.
====

// UI Description (Total count): The total number of checkpoint events executed since the server started.
// This value may drop if background maintenance is performed by Aura.

// UI Description (Rate): The total number of checkpoint events executed since the server started.

// UI Description (Cumulative time): The total time in milliseconds spent in checkpointing since the server
// started. This value may drop if background maintenance is performed by Aura.

// UI Description (Duration): The duration of the last checkpoint event in milliseconds. Checkpoints should
// typically take several seconds to several minutes. Values over 30 minutes warrant investigation.


== Monitoring Replan Events

The Monitoring dashboard shows two replan metrics: total count and rate (replanning events per minute).

A low replan rate with occasional spikes is normal and healthy. You'll naturally see replanning when executing new queries for the first time or after schema changes—this is Neo4j adapting to your evolving database.

Consistently high replan rates suggest an optimization opportunity: your queries may benefit from using parameters instead of literal values.

// UI Description (Total count): The total number of times Cypher has replanned a query since the server started.
// If this spikes or is increasing, check that the queries executed are using parameters correctly. This value
// may drop if background maintenance is performed by Aura.

// UI Description (Rate): The total number of times Cypher has replanned a query since the server started.
// If this spikes or is increasing, check that the queries executed are using parameters correctly.


== Optimizing with Query Parameters

Using **query parameters** helps Neo4j efficiently reuse query execution plans. When you use parameters instead of hardcoded values, Neo4j can cache and reuse the same plan for multiple executions.

This query with a hardcoded value requires Neo4j to create a new plan each time the ID changes:

[source,cypher]
----
MATCH (u:User {id: 12345})
RETURN u
----

Using parameters allows Neo4j to reuse the same optimized plan for all user lookups:

[source,cypher]
----
MATCH (u:User {id: $userId})
RETURN u
----

If you notice high replan rates, review your query logs to find opportunities to add parameters. This simple change can significantly improve query performance and reduce planning overhead.


read::Continue to next module[]

[.summary]
== Summary

Checkpoints write committed transaction data from memory to disk, typically taking seconds to a few minutes. Replan events occur when Neo4j recreates query execution plans as your database evolves. Both are normal operations that help maintain database health and performance. Using parameterized queries allows Neo4j to efficiently reuse execution plans, reducing replanning overhead.

