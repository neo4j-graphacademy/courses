= Monitoring CPU Usage
:type: lesson
:order: 3


[.discrete]
== Introduction

CPU is a critical resource for database performance, used for planning and executing queries.

In this lesson, you will learn how to monitor CPU usage, identify bottlenecks, and determine when to scale your instance.


== Understanding CPU Metrics

The CPU Usage metric shows the number of CPU cores being used by your instance.

// UI Description: CPU usage (cores). CPU is used for planning and serving queries. 
// If this metric is constantly spiking or at its limits, consider increasing the size of your instance.

CPU is consumed by:

* Query planning and execution
* Index operations
* Transaction processing
* Data compaction
* Backup operations


== Reading the CPU Usage Chart

The CPU Usage chart displays:

* **Current usage**: Number of cores currently in use
* **Usage over time**: Historical CPU consumption
* **Available cores**: Total cores allocated to your instance (varies by tier and size)


=== Normal CPU Usage Patterns

Normal CPU patterns include a **steady baseline** from background operations and regular queries, **periodic peaks** from batch jobs or scheduled tasks, **gradual increases** as workload grows over time, and **sudden spikes** from large queries or unexpected load. Identifying these patterns distinguishes normal behavior from issues.


== Identifying CPU Issues

Watch for these warning signs:


=== Constantly High CPU

When CPU usage remains consistently near or at instance limits, this indicates a capacity problem. Queries slow down or time out, indicating either an under-provisioned instance or inefficient queries.

**Action required**: Investigate query patterns to determine the cause before scaling the instance.


=== Frequent Spikes

Regular CPU spikes typically indicate periodic batch operations, repeatedly executed inefficient queries, or lock contention.

**Action required**: Review query logs during spike periods to identify problematic operations.


=== Sustained 100% Usage

Sustained 100% CPU usage causes query failures or timeouts, degrades transaction processing, and indicates the system has reached capacity limits.

**Action required**: Scale the instance immediately or identify and stop problematic queries.


== When to Scale Your Instance

Consider increasing instance size when CPU usage consistently exceeds 70-80%, query performance remains degraded after optimization, peak usage regularly hits 100%, or growth trends indicate future capacity issues.

[TIP]
.Proactive scaling
====
Proactive scaling based on trends prevents performance degradation. Reactive scaling addresses problems after users are affected.

Monitor metrics over weeks and months. Scale when trends indicate approaching capacity limits rather than waiting for 100% utilization.
====


== Optimizing CPU Usage

Before scaling, consider these optimization strategies:


=== Query Optimization

* Review query logs for slow or frequent queries
* Add appropriate indexes to speed up queries
* Use query parameters to enable query plan caching
* Avoid Cartesian products and full graph scans


=== Workload Management

* Schedule batch jobs during off-peak hours
* Distribute load across multiple queries instead of large single queries
* Implement connection pooling in applications
* Use read replicas for read-heavy workloads (Business Critical tier)


=== Application Changes

* Cache frequently accessed data at the application level
* Implement pagination for large result sets
* Reduce query frequency when possible
* Use background jobs for non-urgent operations


== Monitoring CPU for Different Workloads

Different workload types have different CPU patterns:


=== Read-Heavy Workloads

* Lower CPU usage overall
* Spikes during complex traversals
* Benefit from page cache optimization


=== Write-Heavy Workloads

* Higher CPU usage for transaction processing
* CPU peaks during index updates
* May benefit from batch write operations


=== Mixed Workloads

* Variable CPU patterns
* May have competing resource needs
* Require careful monitoring and balancing


[.quiz]
== Check Your Understanding

include::questions/1-cpu-action.adoc[leveloffset=+1]


[.summary]
== Summary

You learned how to monitor CPU usage for your Aura instances.

You learned to identify normal CPU patterns, recognize warning signs, and determine when to scale your instance or optimize queries.

In the next lesson, you will learn how to monitor storage consumption and query rates.

