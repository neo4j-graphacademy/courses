= Monitoring CPU Usage
:type: lesson
:order: 3


[.discrete]
== Introduction

CPU is a critical resource for database performance. Your database uses it for planning and executing queries.

In this lesson, you'll learn how to monitor CPU usage, identify bottlenecks, and determine when you need to scale your instance.


== Understanding CPU Metrics

The CPU Usage metric shows the number of CPU cores being used by your instance.

// UI Description: CPU usage (cores). CPU is used for planning and serving queries. 
// If this metric is constantly spiking or at its limits, consider increasing the size of your instance.

CPU is consumed by:

* Query planning and execution
* Index operations
* Transaction processing
* Data compaction
* Backup operations


== Reading the CPU Usage Chart

The CPU Usage chart displays:

* **Current usage**: Number of cores currently in use
* **Usage over time**: Historical CPU consumption
* **Available cores**: Total cores allocated to your instance (varies by tier and size)


=== Normal CPU Usage Patterns

What does normal CPU usage look like? You'll typically see a **steady baseline** from background operations and regular queries, **periodic peaks** from batch jobs or scheduled tasks, **gradual increases** as your workload grows over time, and **sudden spikes** from large queries or unexpected load. Once you identify these patterns, you can tell the difference between normal behavior and actual issues.


== Identifying CPU Issues

Watch for these warning signs:


=== Constantly High CPU

When your CPU usage stays consistently near or at your instance limits, you've got a capacity problem. Queries will slow down or time out. This usually means either your instance is under-provisioned or you have inefficient queries.

**Action required**: Investigate your query patterns to figure out the cause before you scale the instance.


=== Frequent Spikes

Regular CPU spikes typically indicate periodic batch operations, repeatedly executed inefficient queries, or lock contention.

**Action required**: Review query logs during spike periods to identify problematic operations.


=== Sustained 100% Usage

Sustained 100% CPU usage causes query failures or timeouts, degrades transaction processing, and indicates the system has reached capacity limits.

**Action required**: Scale the instance immediately or identify and stop problematic queries.


== When to Scale Your Instance

When should you increase your instance size? Consider scaling when your CPU usage consistently exceeds 70-80%, query performance stays degraded even after optimization, peak usage regularly hits 100%, or growth trends show you'll have capacity issues soon.

[TIP]
.Proactive scaling
====
Here's the key difference: proactive scaling based on trends prevents performance degradation. Reactive scaling fixes problems after your users are already affected.

Monitor your metrics over weeks and months. Scale when trends show you're approaching capacity limits - don't wait until you hit 100% utilization.
====


== Optimizing CPU Usage

Before scaling, consider these optimization strategies:


=== Query Optimization

* Review query logs for slow or frequent queries
* Add appropriate indexes to speed up queries
* Use query parameters to enable query plan caching
* Avoid Cartesian products and full graph scans


=== Workload Management

* Schedule batch jobs during off-peak hours
* Distribute load across multiple queries instead of large single queries
* Implement connection pooling in applications
* Use read replicas for read-heavy workloads (Business Critical tier)


=== Application Changes

* Cache frequently accessed data at the application level
* Implement pagination for large result sets
* Reduce query frequency when possible
* Use background jobs for non-urgent operations


== Monitoring CPU for Different Workloads

Different workload types have different CPU patterns:


=== Read-Heavy Workloads

* Lower CPU usage overall
* Spikes during complex traversals
* Benefit from page cache optimization


=== Write-Heavy Workloads

* Higher CPU usage for transaction processing
* CPU peaks during index updates
* May benefit from batch write operations


=== Mixed Workloads

* Variable CPU patterns
* May have competing resource needs
* Require careful monitoring and balancing


[.quiz]
== Check Your Understanding

include::questions/1-cpu-action.adoc[leveloffset=+1]


[.summary]
== Summary

You now know how to monitor CPU usage for your Aura instances.

You've learned to identify normal CPU patterns, recognize warning signs, and determine when you need to scale your instance or optimize queries.

In the next lesson, you'll learn how to monitor storage consumption and query rates.

