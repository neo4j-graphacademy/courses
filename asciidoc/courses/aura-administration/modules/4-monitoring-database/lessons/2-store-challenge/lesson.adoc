=  Database Compaction
:type: challenge
:order: 2


== Scenario

You're reviewing monthly database metrics and notice something interesting about your storage usage.

**Current metrics:**

* **Allocated Space**: 180GB
* **Used Space**: 95GB  
* **Difference**: 85GB (47% of allocated space unused)

**History:**

* 3 months ago: Allocated 120GB, Used 110GB (8% difference)
* 2 months ago: Allocated 160GB, Used 120GB (25% difference)
* Last month: Allocated 180GB, Used 95GB (47% difference)

**Context:**

* Last month, the development team performed a major data cleanup
* Deleted approximately 2 million obsolete nodes and their relationships
* Database functionality is normal
* Query performance is good
* Storage costs are becoming noticeable


== The Challenge

What should you do about the large difference between allocated and used space?


include::questions/1-compaction-decision.adoc[leveloffset=+1]


[.summary]
== Summary

When allocated space exceeds used space by more than 30-40%, compact the database to reclaim wasted storage. This is especially beneficial after major data deletions

**Compaction process:**

1. Schedule during maintenance window (requires downtime)
2. Export database using `neo4j-admin database dump`
3. Create new instance or clear existing
4. Import dump using `neo4j-admin database load`
5. Verify data integrity

**After compaction:**

* Allocated space reduces to match used space
* Storage costs decrease
* Slight performance improvement possible

Reclaimed space available for future growth

Compacting from 180GB to 95GB would save 85GB of storage costs.

