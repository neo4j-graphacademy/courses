#! /bin/sh

TMP_FOLDER=/tmp
TARGET_FOLDER=/app

# echo "Saving Google credentials..."
echo $GOOGLE_APPLICATION_CREDENTIALS_CONTENT >> $GOOGLE_APPLICATION_CREDENTIALS

for folder in "certifications" "courses" "html"
do
   echo "Downloading $folder"

   aws s3 cp s3://$CERTS_COURSES_BUCKET_NAME/content/$folder.zip $TMP_FOLDER/$folder.zip
   unzip -q -d $TMP_FOLDER/$folder $TMP_FOLDER/$folder.zip
done

echo "Copying courses"
echo "$TMP_FOLDER/courses/asciidoc/"
echo "$TARGET_FOLDER/asciidoc/"

cp -rf $TMP_FOLDER/courses/asciidoc/ $TARGET_FOLDER/asciidoc #2>/dev/null

echo "Overwriting certifications"
echo "$TMP_FOLDER/certifications/asciidoc/certifications/"
echo "$TARGET_FOLDER/asciidoc/certifications/"

cp -rf $TMP_FOLDER/certifications/asciidoc/certifications/ $TARGET_FOLDER/asciidoc/certifications/ #2>/dev/null

echo "Copying HTML"
cp -rf $TMP_FOLDER/html/ $TARGET_FOLDER #2>/dev/null

echo "copying HTML"
cp -rf $TMP_FOLDER/html/ $TARGET_FOLDER 2>/dev/null

npm run $1
