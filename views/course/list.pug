extends ../layouts/two-column
include ../course/card

mixin recurse(child, link='/categories')
  li.secondary-nav-item(class=`category--${child.slug} ${child.slug === slug ? 'secondary-nav-item--active' : ''}`)
    a(href=child.link) !{child.shortName || child.title}
      if child.courses.filter(course => course.status == 'active').length > 0
        | #{' '}(!{child.courses.filter(course => course.status == 'active').length})

    if child.children && child.children.length
      ul.secondary-nav-list
        for child in category.children
          +recurse(child)

block minor
  nav.secondary-nav.secondary-nav--collapsible
    form.form#search(method='get')
      svg(width='20' height='20' viewbox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg')
        path(d='M17.5 17.5L12.5 12.5M14.1667 8.33333C14.1667 11.555 11.555 14.1667 8.33333 14.1667C5.11167 14.1667 2.5 11.555 2.5 8.33333C2.5 5.11167 5.11167 2.5 8.33333 2.5C11.555 2.5 14.1667 5.11167 14.1667 8.33333Z' stroke='#535B66' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round')

      input(type='text' name='search' value=term placeholder='Search Courses')

    if slug || term
      a.label.label--neutral-strong(href='/categories/') Clear filter
        svg(width='16' height='16' viewbox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg')
          path(d='M4 12L12 4M4 4L12 12' stroke='#4D5157' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round')

    h2.secondary-nav-title.body-small !{translate('browse-courses', 'Browse Courses')}

    for cat in categories
      if cat.children.length
        div.secondary-nav-group(class=`category--${cat.slug}`)
          h2.secondary-nav-header !{cat.shortName || cat.title || cat.slug}

          if cat.children && cat.children.length
            ul.secondary-nav-list
              for child in cat.children
                +recurse(child)

block major


  if !hasResults
    h2.course-group-title No Courses Found
    p.course-group-description We can't find any courses that match your criteria.  You can try
      |
      |
      a(href='/courses/') browsing all courses
      | .
  else
    .course-grid
      for group in grouped
        if group.slug != 'redirect'
          if group && group.courses
            for course in group.courses.filter(n => n.display)
              .course-grid-item
                +course(course, course.categories[0])
