---
description: When writing Cypher statements to query a Neo4j Database
globs:
alwaysApply: false
---

## Cypher Styleguide

Reference: https://neo4j.com/docs/cypher-manual/current/styleguide/

### Keywords and Casing

- Write **keywords in UPPER CASE**: `MATCH`, `WHERE`, `RETURN`, `CREATE`, `DELETE`
- Write **null, true, false in lower case**
- Use **camelCase** for: functions, properties, variables, parameters

Bad:
```cypher
match (p:Person)
where p.name starts with 'Ma'
return p.name
```

Good:
```cypher
MATCH (p:Person)
WHERE p.name STARTS WITH 'Ma'
RETURN p.name
```

### Indentation and Line Breaks

- Use **2 spaces** for indentation (not tabs)
- Start each **clause on a new line**
- For multi-line `CASE` expressions, place each `WHEN` on its own line

Bad:
```cypher
MATCH (n:Person {name: 'Alice'}) RETURN CASE WHEN n.age >= 18 THEN 'Adult' ELSE 'Minor' END AS ageGroup
```

Good:
```cypher
MATCH (n:Person {name: 'Alice'})
RETURN
  CASE
    WHEN n.age >= 18 THEN 'Adult'
    ELSE 'Minor'
  END AS ageGroup
```

### Spacing

- **No space** between opening brace and first key in maps: `{key1: 'value'}`
- **One space** between colon and value in maps
- **One space** between label predicates and property predicates: `(p:Person {name: 'Alice'})`
- **No space** in patterns between nodes and relationships: `(:Person)-->(:Movie)`
- **Wrap operators with spaces**: `WHERE s.name <> e.name`
- **Space after commas**: `RETURN list, 2, 3, 4`

Bad:
```cypher
WITH { key1 :'value' ,key2  :  42 } AS map
MATCH (:Person) --> (:Vehicle)
```

Good:
```cypher
WITH {key1: 'value', key2: 42} AS map
MATCH (:Person)-->(:Vehicle)
```

### Patterns

- **Chain patterns** to avoid repeating variables
- Use **anonymous nodes** when the variable would not be used
- Prefer **outgoing relationships** (left to right)
- Put **named nodes before anonymous nodes**

Bad:
```cypher
MATCH (kate:Person {name: 'Kate'})-[r:LIKES]-(c:Car)
RETURN c.type
```

Good:
```cypher
MATCH (:Person {name: 'Kate'})-[:LIKES]-(c:Car)
RETURN c.type
```

### Meta-characters

- Use **single quotes** for STRING values: `'Cypher'` not `"Cypher"`
- **Avoid backticks** - don't use characters requiring quoted identifiers
- **No semicolon** at the end of statements

Bad:
```cypher
RETURN "Cypher";
```

Good:
```cypher
RETURN 'Cypher'
```

## Only use OPTIONAL MATCH as a last resort

### Need a count of paths, nodes or relationship types? Use a COUNT subquery

Bad:

```cypher
MATCH (m:Movie)
WHERE m.title = 'The Matrix'

OPTIONAL MATCH (:Person)-[:ACTED_IN]->(m)

RETURN m.title, count(*) AS count
```

Good:

```cypher
MATCH (m:Movie)
WHERE m.title = 'The Matrix'
RETURN m.title, COUNT { (:Person)-[:ACTED_IN]->(m) }
```

### Need (nested) values? Use a pattern comprehension

Bad:

```cypher
MATCH (m:Movie)
WHERE m.title = 'The Matrix'

OPTIONAL MATCH (p:Person)-[:ACTED_IN]->(m)

WHERE m.title = 'The Matrix'
RETURN m.title, collect(p.name) AS actors
```

Good:

```cypher
MATCH (m:Movie)
WHERE m.title = 'The Matrix'
RETURN m.title, [ (p:Person)-[:ACTED_IN]->(m) | p.name ]
```
